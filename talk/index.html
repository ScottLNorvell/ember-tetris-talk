<!doctype html>
<html>
  <head>
    <title>Ember Tetris Talk</title>
    <link href='http://fonts.googleapis.com/css?family=Lato:100,400,900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="talk.css">
    <!-- See folder for all the sweet styles available! -->
    <link rel="stylesheet" href="../vendor/highlightjs/styles/github.css">
    <script src="../vendor/bespoke.js/dist/bespoke.min.js"></script>
    <script src="../vendor/bespoke-scale/dist/bespoke-scale.min.js"></script>
    <script src="../vendor/bespoke-progress/dist/bespoke-progress.min.js"></script>
    <script src="../vendor/bespoke-loop/dist/bespoke-loop.min.js"></script>
    <script src="../vendor/bespoke-backdrop/dist/bespoke-backdrop.min.js"></script>
    <script src="../vendor/bespoke-keys/dist/bespoke-keys.min.js"></script>
    <script src="../vendor/bespoke-touch/dist/bespoke-touch.min.js"></script>
    <script src="../vendor/bespoke-classes/dist/bespoke-classes.min.js"></script>
    <script src="../vendor/bespoke-state/dist/bespoke-state.min.js"></script>
    <script src="../vendor/bespoke-hash/dist/bespoke-hash.min.js"></script>
    <script src="../vendor/bespoke-bullets/dist/bespoke-bullets.min.js"></script>
    <script src="../vendor/jquery/dist/jquery.min.js"></script>
    <!-- So let's highlight code that's in a `<pre><code></code></pre>` situation -->
    <script src="../vendor/highlightjs/highlight.pack.js"></script>
    <script src="talk.js"></script>
  </head>
  <body>
    <article id="talk" class="slides">
      <section class="slide" data-bespoke-state="is-title">
        <inner>
          <h2 class="slide__title">The Greatest Addon Ever</h2>
          <img src="images/ember-install.png" alt="" class="slide__image">
          <p class="slide__copy">Or How I Moved To Port Chester And Decided To Use My Longer Commute To Build Tetris With Ember On Metro North...</p>
        </inner>
      </section>
      <section class="slide" data-bespoke-state="is-title">
        <inner>
          <h2 class="slide__title">About Me</h2>
          <ul class="slide__list">
            <li class="slide__list__item">
              <i class="cne-icon--check"></i>
              <span>Scott Norvell</span>
            </li>
            <li class="slide__list__item">
              <i class="cne-icon--check"></i>
              <span>@ScottLNorvell</span>
            </li>
            <li class="slide__list__item">
              <i class="cne-icon--check"></i>
              <span>Cond√© Nast Entertainment</span>
            </li>
          </ul>
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">You may have heard of some of our publications.</p>
          <img src="images/cn-magazines.png" alt="" class="slide__image">
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">You've probably heard of this:</p>
          <img src="images/reddit-logo.jpg" alt="" class="slide__image">
        </inner>
      </section>
      <section class="slide">
        <inner>
          <h2 class="slide__title">I Work On</h2>
          <i class="cne-icon--thescene"></i>
          <p class="slide__copy"><code class="special">
            Built on Ember 2.1.0
          </code></p>
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">As of yesterday...</p>
          <img src="images/yesterday.jpg" alt="" class="slide__image">
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">Our team issued a tetris challenge</p>
          <img src="images/tetris-challenge.jpg" alt="" class="slide__image">
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">Tetris is full of reusable components!</p>
          <img src="images/tetris-classic.jpg" alt="" class="slide__image">
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">I decide to use SVG</p>
          <img src="images/svg-logo.png" alt="" class="slide__image">
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">Because of this guy:</p>
          <img src="images/matt-github.png" alt="" class="slide__image">
          <p class="slide__copy"><code class="special">
            Matt Beale
          </code></p>
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">Ember used to be full of these:</p>
          <img src="images/metamorph-monster.jpg" alt="" class="slide__image">
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">Wait no sorry, these:</p>
          <img src="images/metamorph-tags.png" alt="" class="slide__image">
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">Wait these are less scary...</p>
          <img src="images/metamorph-monster.jpg" alt="" class="slide__image">
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">I told Matt about it and he was like</p>
          <img src="images/mixonic.jpg" alt="" class="slide__image">
          <p class="slide__copy"><code class="special">
            Matt Beale
          </code></p>
        </inner>
      </section>
      <section class="slide">
        <inner>
          <h2 class="slide__title">Research</h2>
          <img src="images/research.jpg" alt="" class="slide__image">
          <p class="slide__copy"><code class="special">
            Just play a lot of tetris?
          </code></p>
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">Turns out there's a tetris wiki</p>
          <img src="images/tetris-wiki-2.png" alt="" class="slide__image">
          <p class="slide__copy"><code class="special">
            who knew?
          </code></p>
        </inner>
      </section>
      <section class="slide" data-bespoke-state="is-section">
        <inner>
          <h2 class="slide__title">Fun Facts</h2>
          <ul class="slide__list">
            <li class="slide__list__item">
              <i class="cne-icon--check"></i>
              <span>Pieces are called tetrominos</span>
            </li>
            <li class="slide__list__item">
              <i class="cne-icon--check"></i>
              <span>each piece is named after the letter it resembles</span>
            </li>
            <li class="slide__list__item">
              <img src="images/tetris-pieces.png" class="slide__image">
            </li>
          </ul>
        </inner>
      </section>
      <section class="slide">
        <inner>
          <h2 class="slide__title">Wicked Simple...</h2>
          <p class="slide__copy">Run this:</p>
          <pre><code class="bash">$ ember install ember-tetris</code></pre>
          <p class="slide__copy">Add it to app like this:</p>
          <pre><code class="html">// error.hbs
&lt;h2&gt;We're Sorry Something Went Wrong&lt;/h2&gt;
&lt;p&gt;Why not play tetris while you wait.&lt;/p&gt;
{{ttr-game}}
          </code></pre>
        </inner>
      </section>
      <section class="slide" data-bespoke-state="is-title">
        <inner>
          <img src="images/lets-see.jpg" alt="" class="slide__image">
          <p class="slide__copy"><code class="special">
            <a class="slide__link" href="http://localhost:4200/" target="_blank">link</a>
          </code></p>
        </inner>
      </section>
      <section class="slide">
        <inner>
          <h2 class="slide__title">Deep Dive</h2>
          <img src="images/deep-dive.jpg" alt="" class="slide__image">
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">Hopefully I didn't use any</p>
          <img src="images/weird-tricks.png" alt="" class="slide__image">
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">Hardcode information about your tetrominos</p>
          <pre><code class="javascript">// utils/tetrominos.js
const { merge } = Ember;
function defaultAttrs() {
  return {
    box: [3,3],
    origin: 'center',
    rotationOrigin: [1,1],
    rotations: 4,
    nextCenter: [1, 1.5]
  };
}

export default {
  t: merge(defaultAttrs(), {
      positions: [
        [1,0,1,2],
        [0,1,1,1]
      ]
    }),
// ...</code></pre>
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">Bind to transform properties on your tetromino component</p>
          <pre><code class="javascript">// components/ttr-tetrominos.js

// ...
style: computed('xPos', 'yPos', 'rotation', 'origin', 'scale', function() {
  let xPos = this.get('xPos');
  let yPos = this.get('yPos');
  let rotation = this.get('rotation');
  let origin = this.get('origin');
  let scale = this.get('scale');
  if (typeof origin !== 'string') {
    origin = `${origin[0] * scale}px ${origin[1] * scale}px`;
  }
  let style = `transform: translate(${xPos * scale}px, ${yPos * scale}px) ` +
    `rotate(${rotation * 90}deg); transform-origin: ${origin}`;
  return Ember.String.htmlSafe(style);
})
// ...</code></pre>
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">What about collision detection?</p>
          <img src="images/cat-collision.jpg" alt="" class="slide__image">
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">It's really simple</p>
          <pre><code class="javascript">// fake/collision-detecter.js
var overlaps = (function () {
  function getPositions( elem ) {
    var pos, width, height;
    pos = $( elem ).position();
    width = $( elem ).width();
    height = $( elem ).height();
    return [ [ pos.left, pos.left + width ], [ pos.top, pos.top + height ] ];
  }

  function comparePositions( p1, p2 ) {
    var r1, r2;
    r1 = p1[0] < p2[0] ? p1 : p2;
    r2 = p1[0] < p2[0] ? p2 : p1;
    return r1[1] > r2[0] || r1[0] === r2[0];
  }

  return function ( a, b ) {
    var pos1 = getPositions( a ),
        pos2 = getPositions( b );
    return comparePositions( pos1[0], pos2[0] ) && comparePositions( pos1[1], pos2[1] );
  };
})();

$(function () {
  var area = $( '#area' )[0],
    box = $( '#box0' )[0],
    html;

  html = $( area ).children().not( box ).map( function ( i ) {
    return '<p>Red box + Box ' + ( i + 1 ) + ' = ' + overlaps( box, this ) + '</p>';
  }).get().join( '' );

  $( 'body' ).append( html );
});</code></pre>
        </inner>
      </section>
      <section class="slide">
        <inner>
          <img src="images/just-kidding.jpg" alt="" class="slide__image">
          <p class="slide__copy"><code class="special">
            <a class="slide__link" href="http://localhost:4200/" target="_blank">back to the demo</a>
          </code></p>
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy"><code class="special">It's ~kinda~ simple</code> </p>
          <pre><code class="javascript">// services/tetromino.js
willCollide(direction) {
  let locations = this.get('locations');
  switch (direction) {
    case 'right':
      return locations.any((loc) => {
        let {x,y} = loc;
        return loc.x === rightLimit;
      });
    case 'left':
      return locations.any((loc) => {
        let {x,y} = loc;
        return loc.x === leftLimit;
      });
    case 'down':
      return locations.any((loc) => {
        let {x,y} = loc;
        return y === downLimit;
      });
  }
},</code></pre>
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">What about other collisions?</p>
          <img src="images/other-collision.jpg" alt="" class="slide__image">
          <p class="slide__copy"><code class="special">
            <a class="slide__link" href="http://localhost:4200/" target="_blank">back to the demo</a>
          </code></p>
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">Custom Data Structure</p>
          <pre><code class="javascript">// services/played.js
squareSet: computed(function() {
  return new Set();
}),
lines: computed(function() {
  return Ember.Object.create();
}),
squares: computed(function() {
  let squares = Ember.A([]);
  squares.__pushObject = squares.pushObject;
  let squareSet = this.get('squareSet');
  let service = this;
  squares.pushObject = function(_pt) {
    let lines = service.get('lines');
    let pt = Ember.Object.create(_pt);
    squareSet.add(toSquareKey(pt));
    if (lines[pt.y]) {
      lines[pt.y].pushObject(pt);
    } else {
      lines[pt.y] = Ember.A([pt]);
    }
    this.__pushObject(pt);
  };
  return squares;
}),</code></pre>
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">Will Collide Becomes</p>
          <pre><code class="javascript">// services/tetromino.js
willCollide(direction) {
  let locations = this.get('locations');
  let squareSet = this.get('squareSet');
  switch (direction) {
    case 'right':
      return locations.any((loc) => {
        let {x,y} = loc;
        return loc.x === rightLimit || squareSet.has(toSquareKey({x: x + 1, y: y}));
      });
    case 'left':
      return locations.any((loc) => {
        let {x,y} = loc;
        return loc.x === leftLimit || squareSet.has(toSquareKey({x: x - 1, y: y}));
      });
    case 'down':
      return locations.any((loc) => {
        let {x,y} = loc;
        return y === downLimit || squareSet.has(toSquareKey({x: x, y: y + 1}));
      });
  }
},</code></pre>
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">There's also cannotRotate</p>
          <pre><code class="javascript">// services/tetromino.js
cannotRotate(rotation) {
  let positions = this.get('positions');
  let squareSet = this.get('squareSet');
  let locations = this._applyTransformation(positions, rotation);
  return locations.any((loc) => {
    return loc.x > rightLimit ||
      loc.x < leftLimit ||
      loc.y > downLimit ||
      squareSet.has(toSquareKey(loc));
  });
}</code></pre>
        </inner>
      </section>

      <section class="slide">
        <inner>
          <p class="slide__copy">_applyTransformation? What's that?</p>
          <img src="images/transformers.jpg" alt="" class="slide__image">
          <p class="slide__copy"><code class="special">
            <a class="slide__link" href="http://localhost:4200/" target="_blank">back to the demo</a>
          </code></p>
        </inner>
      </section>

      <section class="slide">
        <inner>
          <p class="slide__copy">Call your mom (the geometry teacher) for some math:</p>
          <pre><code class="javascript">// utils/rotations.js
export default {
  // 90deg
  1: '[originX + originY - y, -originX + originY + x]',
  // 180deg
  2: '[(2 * originX) - x, (2 * originY) - y]',
  // 270deg
  3: '[originX - originY + y, originX + originY - x]'
};</code></pre>
        </inner>
      </section>

      <section class="slide">
        <inner>
          <p class="slide__copy">Implement _applyTransformation</p>
          <pre><code class="javascript">// services/tetromino.js
_applyTransformation(positions, rotation) {
  let xPos = this.get('xPos');
  let yPos = this.get('yPos');
  let [originX, originY] = this.get('rotationOrigin');
  let transformedPositions = positions.map((pos) => {
    let {x,y} = pos;
    if (rotation) {
      [x, y] = eval(rotations[rotation]);
    }
    return {
      x: x + xPos,
      y: y + yPos
    };
  });
  return Ember.A(transformedPositions);
},</code></pre>
        </inner>
      </section>

      <section class="slide">
        <inner>
          <h2 class="slide__title">Done with Deep Dive</h2>
          <img src="images/done-deep-dive.jpg" alt="" class="slide__image">
          <p class="slide__copy">Any Questions?</p>
        </inner>
      </section>
      <section class="slide">
        <inner>
          <p class="slide__copy">The End</p>
          <i class="cne-icon--thescene"></i>
          <p class="slide__copy"><code class="special">We're Hiring</code></p>
        </inner>
      </section>
    </article>
  </body>
</html>

